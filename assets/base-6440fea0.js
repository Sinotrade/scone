import{a as o,W as u,C as d}from"./index-e65d018c.js";class c extends Error{constructor(e,t){super(e),this.code=o[t]}}class n extends u{constructor(){super(...arguments),this.prefix="capacitor-storage_",this.sync=!1}async setSynchronize(e){return this.sync=e,d.getPlatform()==="ios"?this.setSynchronizeKeychain({sync:e}):Promise.resolve()}async getSynchronize(){return Promise.resolve(this.sync)}async get(e,t=!0,s){if(e){const{data:r}=await this.internalGetItem({prefixedKey:this.prefixedKey(e),sync:s??this.sync});if(t){const i=m(r);if(i)return Promise.resolve(i)}return Promise.resolve(JSON.parse(r))}return n.missingKey()}async getItem(e){if(e)try{const{data:t}=await this.internalGetItem({prefixedKey:this.prefixedKey(e),sync:this.sync});return t}catch(t){if(t instanceof c&&t.code===o[o.notFound])return null;throw t}return null}async set(e,t,s=!0,r){if(e){let i=t;return s&&t instanceof Date&&(i=t.toISOString()),this.internalSetItem({prefixedKey:this.prefixedKey(e),data:JSON.stringify(i),sync:r??this.sync})}return n.missingKey()}async setItem(e,t){return e?this.internalSetItem({prefixedKey:this.prefixedKey(e),data:t,sync:this.sync}):n.missingKey()}async remove(e,t){if(e){const{success:s}=await this.internalRemoveItem({prefixedKey:this.prefixedKey(e),sync:t??this.sync});return Promise.resolve(s)}return n.missingKey()}async removeItem(e){return e&&await this.internalRemoveItem({prefixedKey:this.prefixedKey(e),sync:this.sync}),n.missingKey()}async keys(e){const{keys:t}=await this.getPrefixedKeys({prefix:this.prefix,sync:e??this.sync}),s=this.prefix.length;return Promise.resolve(t.map(r=>r.slice(s)))}async getKeyPrefix(){return Promise.resolve(this.prefix)}async setKeyPrefix(e){return this.prefix=e,Promise.resolve()}prefixedKey(e){return this.prefix+e}static missingKey(){throw new c("No key provided",o.missingKey)}}const l=/^"(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})Z"$/u;function m(a){const e=l.exec(a);if(e){const t=parseInt(e[1],10),s=parseInt(e[2],10)-1,r=parseInt(e[3],10),i=parseInt(e[4],10),y=parseInt(e[5],10),h=parseInt(e[6],10),f=parseInt(e[7],10),p=Date.UTC(t,s,r,i,y,h,f);return new Date(p)}return null}export{n as S,c as a};

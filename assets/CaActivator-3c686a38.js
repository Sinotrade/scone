import{c as n,$ as l}from"./AppHeader-516f74e8.js";import{c as r,q as w,u as S,j as $,b as x}from"./index-b24940c9.js";import{l as g}from"./index-9a3dda6b.js";import{SLoginInputGroup as P,SLoginInput as k,SLoginLabel as z}from"./Login-6504f1c5.js";import{T as _,S as b}from"./LoaderIcon-db04925b.js";import{T as m}from"./index-9f98095c.js";import{S as N}from"./SFlexCenter-0011bbd8.js";import{t as u}from"./toast-d73a05cc.js";import"./_commonjsHelpers-042e6b4d.js";var V=n({defaultClassName:"szv9zw0",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),B=n({defaultClassName:"szv9zw1",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),I=n({defaultClassName:"szv9zw5",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),j=n({defaultClassName:"szv9zw4",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),A=n({defaultClassName:"szv9zw6",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),y=n({defaultClassName:"szv9zw3",variantClassNames:{},defaultVariants:{},compoundVariants:[]});n({defaultClassName:"szv9zw2",variantClassNames:{},defaultVariants:{},compoundVariants:[]});var F=n({defaultClassName:"_1j0pug70",variantClassNames:{size:{sm:"_1j0pug71",md:"_1j0pug72",lg:"_1j0pug73"}},defaultVariants:{size:"lg"},compoundVariants:[]}),T=n({defaultClassName:"_1j0pug74",variantClassNames:{size:{sm:"_1j0pug75",md:"_1j0pug76",lg:"_1j0pug77"}},defaultVariants:{size:"lg"},compoundVariants:[]}),L=n({defaultClassName:"_1j0pug78",variantClassNames:{size:{sm:"_1j0pug79",md:"_1j0pug7a",lg:"_1j0pug7b"}},defaultVariants:{size:"sm"},compoundVariants:[]});const M=l("label",F),R=l("input",T),E=l("div",L),K=a=>r(M,{get size(){return a.size},get children(){return[r(R,{type:"checkbox",get size(){return a.size},get onClick(){return a.onClick},get checked(){return a.checked}}),r(E,{get size(){return a.size}})]}}),D=l("div",V),G=l("div",B),q=l("p",y),U=l("div",j),O=l("input",I),X=l("label",A),v=(a,f,t)=>{try{let o=g.util.decode64(a),p=g.asn1.fromDer(o),C=g.pkcs12.pkcs12FromAsn1(p,f),c=g.pki.oids.pkcs8ShroudedKeyBag,[{key:d}]=C.getBags({bagType:c})[c]||[];c=g.pki.oids.certBag;let[{cert:e}]=C.getBags({bagType:c})[c]||[],s=e?.subject.getField("CN").value;if(d&&e){d=d;let i={key:d,cert:e};const h={[s]:i};u.success("Ca Activated",{...m,duration:1e3}),setTimeout(()=>{console.log("addActivatedCa"),t("addActivatedCa",h),t("selectCa",s)},1100)}else u.error("Invalid PFX.",m)}catch(o){o instanceof Error&&(o.message==="PKCS#12 MAC could not be verified. Invalid password?"&&u.error("Invalid password.",m),console.error(o))}},se=()=>{const[a,f]=w(""),[t,o]=S(),[p,C]=w(""),c="Sinopac.pfx";localStorage[c]&&f(c);let d=new FileReader;return d.onload=e=>{let s=e.target;if(s.result){let i=s.result;o("setPfxB64",{filename:a(),b64:i.replace("data:application/x-pkcs12;base64,","")})}},$(()=>{if(a()===""){const e=Object.keys(t.pfxB64);if(e.length>0){const s=e[0];if(f(s),s!==""&&t.rememberPfxPassword){const i=t.pfxPassword[s];i&&v(t.pfxB64[s],i,o)}}}else if(t.rememberPfxPassword){const e=t.pfxPassword[a()];e&&v(t.pfxB64[a()],e,o)}}),r(D,{get children(){return[r(_,{position:"top-center"}),r(G,{get children(){return[r(U,{get children(){return r(X,{get children(){return[x(()=>x(()=>a()==="")()?"Choose File":a()),r(O,{hidden:!0,type:"file",accept:".pfx",onInput:e=>{let s=e.target;if(s.files&&s.files.length>0){let i=s.files[0];f(i.name),d.readAsDataURL(i)}}})]}})}}),r(P,{get children(){return[r(k,{required:!0,type:"password",get value(){return x(()=>!!t.rememberPfxPassword)()?t.pfxPassword[a()]:p()},onKeyUp:e=>{let s=e.target;t.rememberPfxPassword?o("setPfxPassword",{filename:a(),password:s.value}):C(s.value)},onKeyPress:e=>{e.target,e.key==="Enter"&&(a()!==""?v(t.pfxB64[a()],t.rememberPfxPassword?t.pfxPassword[a()]:p(),o):u.error("Ca file not select.",m))}}),r(z,{children:"Password"})]}}),r(N,{direction:"row",get children(){return[r(K,{size:"sm",get checked(){return t.rememberPfxPassword},onClick:e=>{o("setRememberPfxPassword",e.currentTarget.checked),console.log(e.currentTarget.checked)}}),r(q,{children:"Remember Password"})]}}),r(P,{get children(){return r(b,{onClick:()=>{if(a()!==""){const e=t.rememberPfxPassword?t.pfxPassword[a()]:p();e!==""?v(t.pfxB64[a()],e,o):u.error("Password is empty",m)}else u.error("Ca file not select.",m)},children:"ACTIVATE CA"})}})]}})]}})};export{se as default};

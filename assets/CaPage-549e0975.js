import{c as l,$ as m,T as V,M as y,S as z,a as I,A as T,b as _,d as k}from"./AppHeader-6967ca86.js";import{b as S,u as N,c as a,d as h,e as P,a as x}from"./index-8f3c35d6.js";import{l as d}from"./index-3e3f0b36.js";import{t as p,T as u,s as F,a as $}from"./index-6b556e3b.js";import{T as E,S as A,a as L,b as M}from"./Login-16a5cbdc.js";import{S as B}from"./Sbutton-76e8d985.js";import"./_commonjsHelpers-87174ba5.js";var K=l({defaultClassName:"szv9zw0",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),D=l({defaultClassName:"szv9zw1",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),G=l({defaultClassName:"szv9zw5",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),R=l({defaultClassName:"szv9zw4",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),j=l({defaultClassName:"szv9zw6",variantClassNames:{},defaultVariants:{},compoundVariants:[]});l({defaultClassName:"szv9zw3",variantClassNames:{},defaultVariants:{},compoundVariants:[]});l({defaultClassName:"szv9zw2",variantClassNames:{},defaultVariants:{},compoundVariants:[]});const U=m("div",K),q=m("div",D),H=m("div",R),J=m("input",G),O=m("label",j),w=(t,o,f)=>{const v="activatedCa";try{let r=d.util.decode64(t),C=d.asn1.fromDer(r),c=d.pkcs12.pkcs12FromAsn1(C,o),n=d.pki.oids.pkcs8ShroudedKeyBag,[{key:e}]=c.getBags({bagType:n})[n]||[];n=d.pki.oids.certBag;let[{cert:s}]=c.getBags({bagType:n})[n]||[],i=s?.subject.getField("CN").value;if(e&&s){e=e;let b={key:e,cert:s};if(F.activatedCa){let g={};g[i]=b,$(v,g),$("selectedCa",i),f("addActivatedCa",g),f("selectCa",i)}}p.success("Ca Activated",u)}catch(r){r instanceof Error&&(r.message==="PKCS#12 MAC could not be verified. Invalid password?"&&p.error("Invalid password.",u),console.error(r))}},Q=()=>{const[t,o]=S(""),[f,v]=N(),[r,C]=S(""),c="Sinopac.pfx";localStorage[c]&&o(c);let n=new FileReader;return n.onload=e=>{let s=e.target;if(s.result){let i=s.result;localStorage[`${t()}`]=i.replace("data:application/x-pkcs12;base64,","")}},a(U,{get children(){return[a(E,{position:"top-center"}),a(q,{get children(){return[a(H,{get children(){return a(O,{get children(){return[h(()=>h(()=>t()==="")()?"Choose File":t()),a(J,{hidden:!0,type:"file",accept:".pfx",onInput:e=>{let s=e.target;if(s.files&&s.files.length>0){let i=s.files[0];o(i.name),n.readAsDataURL(i)}}})]}})}}),a(A,{get children(){return[a(L,{required:!0,type:"password",onKeyUp:e=>{let s=e.target;C(s.value)},onKeyPress:e=>{e.target,e.key==="Enter"&&(t()!==""?w(localStorage[`${t()}`],r(),v):p.error("Ca file not select.",u))}}),a(M,{children:"Password"})]}}),a(A,{get children(){return a(B,{onClick:()=>{t()!==""?r()!==""?w(localStorage[`${t()}`],r(),v):p.error("Password is empty",u):p.error("Ca file not select.",u)},children:"ACTIVATE CA"})}})]}})]}})},sa=()=>{const t=P(),[o,f]=N();return x(()=>{console.log("EffectPage"),o.authed||t("/scone/login"),o.hasActivatedCa&&o.authed&&t("/scone/")}),a(k,{get children(){return[a(V,{children:"Scone: Trade App power with Shioaji provide by Sinopac"}),a(y,{name:"viewpoint",content:"width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no"}),a(z,{get children(){return a(I,{get children(){return[a(T,{title:"ACTIVATE CA"}),a(_,{get children(){return a(Q,{})}})]}})}})]}})};export{sa as default};

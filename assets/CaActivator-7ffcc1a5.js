import{c as m,$ as w}from"./AppHeader-87838719.js";import{q as x,u as b,k as h,a as o,d as P}from"./index-09e482ec.js";import{l as v}from"./index-9a3dda6b.js";import{S as g,a as $,b as k,C as N,c as A}from"./Login-6d0f5fdd.js";import{T as z,S as I}from"./LoaderIcon-e97f455a.js";import{T as c}from"./toast-69cb867a.js";import{S as V}from"./SFlexCenter-58d3e439.js";import{t as f}from"./toast-a0180d21.js";import"./_commonjsHelpers-042e6b4d.js";var y=m({defaultClassName:"szv9zw0",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),B=m({defaultClassName:"szv9zw1",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),F=m({defaultClassName:"szv9zw4",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),T=m({defaultClassName:"szv9zw3",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),_=m({defaultClassName:"szv9zw5",variantClassNames:{},defaultVariants:{},compoundVariants:[]});m({defaultClassName:"szv9zw2",variantClassNames:{},defaultVariants:{},compoundVariants:[]});const L=w("div",y),R=w("div",B),E=w("div",T),K=w("input",F),D=w("label",_),C=(s,p,a)=>{try{let r=v.util.decode64(s),d=v.asn1.fromDer(r),u=v.pkcs12.pkcs12FromAsn1(d,p),i=v.pki.oids.pkcs8ShroudedKeyBag,[{key:l}]=u.getBags({bagType:i})[i]||[];i=v.pki.oids.certBag;let[{cert:e}]=u.getBags({bagType:i})[i]||[],t=e?.subject.getField("CN").value;if(l&&e){l=l;let n={key:l,cert:e};const S={[t]:n};f.success("Ca Activated",{...c,duration:1e3}),setTimeout(()=>{console.log("addActivatedCa"),a("addActivatedCa",S),a("selectCa",t)},1100)}else f.error("Invalid PFX.",c)}catch(r){r instanceof Error&&(r.message==="PKCS#12 MAC could not be verified. Invalid password?"&&f.error("Invalid password.",c),console.error(r))}},Q=()=>{const[s,p]=x(""),[a,r]=b(),[d,u]=x(""),i="Sinopac.pfx";localStorage[i]&&p(i);let l=new FileReader;return l.onload=e=>{let t=e.target;if(t.result){let n=t.result;r("setPfxB64",{filename:s(),b64:n.replace("data:application/x-pkcs12;base64,","")})}},h(()=>{if(s()===""){const e=Object.keys(a.pfxB64);if(e.length>0){const t=e[0];if(p(t),t!==""&&a.rememberPfxPassword){const n=a.pfxPassword[t];n&&C(a.pfxB64[t],n,r)}}}else if(a.rememberPfxPassword){const e=a.pfxPassword[s()];e&&C(a.pfxB64[s()],e,r)}}),o(L,{get children(){return[o(z,{position:"top-center"}),o(R,{get children(){return[o(E,{get children(){return o(D,{get children(){return[P(()=>P(()=>s()==="")()?"Choose File":s()),o(K,{hidden:!0,type:"file",accept:".pfx",onInput:e=>{let t=e.target;if(t.files&&t.files.length>0){let n=t.files[0];p(n.name),l.readAsDataURL(n)}}})]}})}}),o(g,{get children(){return[o($,{required:!0,type:"password",get value(){return P(()=>!!a.rememberPfxPassword)()?a.pfxPassword[s()]:d()},onKeyUp:e=>{let t=e.target;a.rememberPfxPassword?r("setPfxPassword",{filename:s(),password:t.value}):u(t.value)},onKeyPress:e=>{e.target,e.key==="Enter"&&(s()!==""?C(a.pfxB64[s()],a.rememberPfxPassword?a.pfxPassword[s()]:d(),r):f.error("Ca file not select.",c))}}),o(k,{children:"Password"})]}}),o(V,{direction:"row",get children(){return[o(N,{size:"sm",get checked(){return a.rememberPfxPassword},onClick:e=>{a.rememberPfxPassword?u(a.pfxPassword[s()]):r("setPfxPassword",{filename:s(),password:d()}),r("setRememberPfxPassword",e.currentTarget.checked),console.log(e.currentTarget.checked)}}),o(A,{children:"Remember Password"})]}}),o(g,{get children(){return o(I,{onClick:()=>{if(s()!==""){const e=a.rememberPfxPassword?a.pfxPassword[s()]:d();e!==""?C(a.pfxB64[s()],e,r):f.error("Password is empty",c)}else f.error("Ca file not select.",c)},children:"ACTIVATE CA"})}})]}})]}})};export{Q as default};

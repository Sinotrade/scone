import{c as o,$ as c,T as $,M as b,S as k,a as z,A as _,b as N,d as A}from"./AppHeader-5a0a02a5.js";import{c as a,b as w,u as S,o as V,d as h,f as B,a as I}from"./index-130bb55a.js";import{S as j,l as g}from"./index-861b073b.js";import{S as x,a as y,b as T}from"./Login-e48c37b1.js";import{T as F,S as M}from"./LoaderIcon-19756f4c.js";import{T as m}from"./index-aa78c80e.js";import{t as p}from"./toast-f3fe577e.js";var E=o({defaultClassName:"szv9zw0",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),L=o({defaultClassName:"szv9zw1",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),R=o({defaultClassName:"szv9zw5",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),K=o({defaultClassName:"szv9zw4",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),D=o({defaultClassName:"szv9zw6",variantClassNames:{},defaultVariants:{},compoundVariants:[]}),G=o({defaultClassName:"szv9zw3",variantClassNames:{},defaultVariants:{},compoundVariants:[]});o({defaultClassName:"szv9zw2",variantClassNames:{},defaultVariants:{},compoundVariants:[]});var U=o({defaultClassName:"_1j0pug70",variantClassNames:{size:{sm:"_1j0pug71",md:"_1j0pug72",lg:"_1j0pug73"}},defaultVariants:{size:"lg"},compoundVariants:[]}),q=o({defaultClassName:"_1j0pug74",variantClassNames:{size:{sm:"_1j0pug75",md:"_1j0pug76",lg:"_1j0pug77"}},defaultVariants:{size:"lg"},compoundVariants:[]}),H=o({defaultClassName:"_1j0pug78",variantClassNames:{size:{sm:"_1j0pug79",md:"_1j0pug7a",lg:"_1j0pug7b"}},defaultVariants:{size:"sm"},compoundVariants:[]});const O=c("label",U),X=c("input",q),J=c("div",H),Q=e=>a(O,{get size(){return e.size},get children(){return[a(X,{type:"checkbox",get size(){return e.size},get onClick(){return e.onClick},get checked(){return e.checked}}),a(J,{get size(){return e.size}})]}}),W=c("div",E),Y=c("div",L),Z=c("p",G),ee=c("div",K),ae=c("input",R),te=c("label",D),v=(e,i,s)=>{try{let n=g.util.decode64(e),f=g.asn1.fromDer(n),C=g.pkcs12.pkcs12FromAsn1(f,i),d=g.pki.oids.pkcs8ShroudedKeyBag,[{key:u}]=C.getBags({bagType:d})[d]||[];d=g.pki.oids.certBag;let[{cert:t}]=C.getBags({bagType:d})[d]||[],r=t?.subject.getField("CN").value;if(u&&t){u=u;let l={key:u,cert:t};const P={[r]:l};p.success("Ca Activated",{...m,duration:1e3}),setTimeout(()=>{console.log("addActivatedCa"),s("addActivatedCa",P),s("selectCa",r)},1100)}else p.error("Invalid PFX.",m)}catch(n){n instanceof Error&&(n.message==="PKCS#12 MAC could not be verified. Invalid password?"&&p.error("Invalid password.",m),console.error(n))}},se=()=>{const[e,i]=w(""),[s,n]=S(),[f,C]=w(""),d="Sinopac.pfx";localStorage[d]&&i(d);let u=new FileReader;return u.onload=t=>{let r=t.target;if(r.result){let l=r.result;n("setPfxB64",{filename:e(),b64:l.replace("data:application/x-pkcs12;base64,","")})}},V(()=>{if(e()===""){const t=Object.keys(s.pfxB64);if(t.length>0){const r=t[0];if(i(r),r!==""&&s.rememberPfxPassword){const l=s.pfxPassword[r];l&&v(s.pfxB64[r],l,n)}}}else if(s.rememberPfxPassword){const t=s.pfxPassword[e()];t&&v(s.pfxB64[e()],t,n)}}),a(W,{get children(){return[a(F,{position:"top-center"}),a(Y,{get children(){return[a(ee,{get children(){return a(te,{get children(){return[h(()=>h(()=>e()==="")()?"Choose File":e()),a(ae,{hidden:!0,type:"file",accept:".pfx",onInput:t=>{let r=t.target;if(r.files&&r.files.length>0){let l=r.files[0];i(l.name),u.readAsDataURL(l)}}})]}})}}),a(x,{get children(){return[a(y,{required:!0,type:"password",get value(){return h(()=>!!s.rememberPfxPassword)()?s.pfxPassword[e()]:f()},onKeyUp:t=>{let r=t.target;s.rememberPfxPassword?n("setPfxPassword",{filename:e(),password:r.value}):C(r.value)},onKeyPress:t=>{t.target,t.key==="Enter"&&(e()!==""?v(s.pfxB64[e()],s.rememberPfxPassword?s.pfxPassword[e()]:f(),n):p.error("Ca file not select.",m))}}),a(T,{children:"Password"})]}}),a(j,{direction:"row",get children(){return[a(Q,{size:"sm",get checked(){return s.rememberPfxPassword},onClick:t=>{n("setRememberPfxPassword",t.currentTarget.checked),console.log(t.currentTarget.checked)}}),a(Z,{children:"Remember Password"})]}}),a(x,{get children(){return a(M,{onClick:()=>{if(e()!==""){const t=s.rememberPfxPassword?s.pfxPassword[e()]:f();t!==""?v(s.pfxB64[e()],t,n):p.error("Password is empty",m)}else p.error("Ca file not select.",m)},children:"ACTIVATE CA"})}})]}})]}})},ue=()=>{const e=B(),[i,s]=S();return I(()=>{console.log("EffectPage"),i.authed||e("/scone/login"),i.hasActivatedCa&&i.authed&&e("/scone/")}),a(A,{get children(){return[a($,{children:"Scone: Trade App power with Shioaji provide by Sinopac"}),a(b,{name:"viewpoint",content:"width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no"}),a(k,{get children(){return a(z,{get children(){return[a(_,{title:"ACTIVATE CA"}),a(N,{get children(){return a(se,{})}})]}})}})]}})};export{ue as default};
